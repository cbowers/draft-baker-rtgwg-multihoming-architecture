<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<!-- Some of the more generally applicable PIs that most I-Ds might want to use -->
<!-- Try to enforce the ID-nits conventions and DTD validity -->
<?rfc strict="yes" ?>
<!-- Items used when reviewing the document -->
<?rfc comments="no" ?>
<!-- Controls display of <cref> elements -->
<?rfc inline="no" ?>
<!-- When no, put comments at end in comments section,
                                 otherwise, put inline -->
<?rfc editing="no" ?>
<!-- When yes, insert editing marks: editing marks consist of a
                                 string such as <29> printed in the blank line at the
                                 beginning of each paragraph of text. -->
<!-- Create Table of Contents (ToC) and set some options for it.
         Note the ToC may be omitted for very short documents,but idnits insists on a ToC
         if the document has more than 15 pages. -->
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<!-- If "yes" eliminates blank lines before main section entries. -->
<?rfc tocdepth="3"?>
<!-- Sets the number of levels of sections/subsections... in ToC -->
<!-- Choose the options for the references.
         Some like symbolic tags in the references (and citations) and others prefer
         numbers. The RFC Editor always uses symbolic tags.
         The tags used are the anchor attributes of the references. -->
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<!-- If "yes", causes the references to be sorted in order of tags.
                                 This doesn't have any effect unless symrefs is "yes" also. -->
<!-- These two save paper: Just setting compact to "yes" makes savings by not starting each
         main section on a new page but does not omit the blank lines between list items.
         If subcompact is also "yes" the blank lines between list items are also omitted. -->
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>
<!-- end of list of popular I-D processing instructions -->
<!-- end of list of processing instructions -->
<rfc category="std" docName="draft-baker-rtgwg-multihoming-architecture-00"
     ipr="trust200902">
  <front>
    <title abbrev="">Enterprise Routing Requirements to Support Multihoming using 
	Provider-Assigned Addresses without Network Prefix Translation</title>

    <author fullname="Fred Baker" initials="F.J." surname="Baker">
      <organization>Cisco Systems</organization>
      <address>
        <postal>
          <street/>
          <city>Santa Barbara</city>
          <code>93117</code>
          <region>California</region>
          <country>USA</country>
        </postal>
        <email>fred@cisco.com</email>
      </address>
    </author>

    <author fullname="Chris Bowers" initials="C." surname="Bowers">
      <organization>Juniper Networks</organization>
      <address>
        <postal>
          <street/>
          <city>Sunnyvale</city>
          <code>94089</code>
          <region>California</region>
          <country>USA</country>
        </postal>
        <email>cbowers@juniper.net</email>
      </address>
    </author>
	
    <author fullname="Jen Linkova" initials="J." surname="Linkova">
      <organization>Google</organization>
      <address>
        <postal>
          <street/>
          <city>Mountain View</city>
          <code>94043</code>
          <region>California</region>
          <country>USA</country>
        </postal>
        <email>furry@google.com</email>
      </address>
    </author>
	
    <date/>

    <area>Routing Area</area>

    <workgroup>Routing Working Group</workgroup>

    <abstract>
      <t>asdf s
	  
	  
	  </t>
    </abstract>

  </front>

  <middle>


<section title="Introduction">

<t>  Connecting an enterprise site to multiple ISPs is commonly
used to provide redundant uplinks to different ISPs.  
If the site uses provider-independent(PI) addresses, all traffic
originating from the enterprise can use source addresses from the PI 
address space.  Site multihoming with PI addresses is commonly used 
with both IPv4 and IPv6, and does not present any new technical challenges.
</t> 

<t>  It may be desireable for an enterprise site to connect to multiple ISPs
using provider-assigned(PA) addresses, instead of PI addresses.  Multihoming with 
provider-assigned addresses is typically less expensive for the enterprise 
relative to using provider-independent addresses.  PA multihoming is also 
a practice that should be facilitated and encouraged because it does not 
add to the size of the Internet routing table, whereas PI multihoming does.  
</t>

<t> With PA multihoming,
for each ISP connection, the site is assigned a prefix from within an address 
block allocated to that ISP by its National or Regional Internet Registry.  
In the simple case of two ISPs (ISP-A and ISP-B), the site will have two
different prefixes assigned to it (prefix-A and prefix-B). This arrangement is 
problematic.  First, packets with the "wrong" source address may 
be dropped by one of the ISPs. 
In order to limit denial of service attacks using spoofed source addresses, 
<xref target="RFC2827">BCP38</xref> recommends that ISPs
filter traffic from customer sites to only allow traffic with a source 
address that has been assigned by that ISP.  So a packet 
sent from a multihomed site on the uplink to ISP-B with a source address
in prefix-A may be dropped by ISP-B.  
</t>

<t>However, even if ISP-B does not implement BCP38 or ISP-B adds
prefix-A to its list of allowed source addresses on the uplink from the multihomed 
site, two-way communication may still fail. If the packet with source address in prefix-A was sent to 
ISP-B because the uplink to ISP-A failed, then 
if ISP-B does not drop the packet and the packet reaches its destination 
somewhere on the Internet, the return packet will be sent 
back with a destination address in prefix-A.  The return packet will be routed over 
the Internet to ISP-A, but it will not be delivered to the multihomed
site because its link with ISP-A has failed.  Two-way communication 
would require some arrangement for ISP-B to advertise prefix-A when 
the uplink to ISP-A fails.
</t>

<t>With IPv4, this problem is commonly solved by using <xref target="RFC1918"/> 
private address space within the multi-homed site and 
Network Address Translation (NAT) or Network Address/Port Translation (NAPT) 
on the uplinks to the ISPs.  However, one of the goals of IPv6 is to eliminate
the need for and the use of NAT or NAPT.  Therefore, requiring the use of NAT or NAPT 
for an enterprise site to multihome with provider-assigned adresses is not an
attractive solution.  
</t>

<t> <xref target="RFC6296"/> describes a translation solution
specifically tailored to meet the requirements of multi-homing
with provider-assigned IPv6 addresses. With the
IPv6-to-IPv6 Network Prefix Translation (NPTv6) solution, within the site
an enterprise can use Unique Local Addresses <xref target="RFC4193"/>
or the prefix assigned by one of the ISPs.
As traffic leaves the site on an uplink to an ISP, the 
source address gets translated to an address within the prefix assigned 
by the ISP on that uplink in a predictable and reversible manner.
<xref target="RFC6296"/> is currently classified as Experimental, 
and it has been implemented by several vendors. See <xref target="sec_nptv6"/>,
for more discussion of NPTv6.
</t>

<t>This document defines routing requirements for enterprise multihoming 
using provider-assigned IPv6 addresses. We have made no attempt to 
write these requirements in a 
manner that is agnostic to potential solutions. Instead, this 
document focuses on the following general class of solutions. 
</t>

<t>Each host at the enterprise has multiple addresses, at least one from 
each ISP prefix. Each host is responsible for choosing which source 
address to apply to each packet it sends. A host should be able respond 
dynamically to the failure of an uplink to a given ISP by no longer 
sending packets with the source address corresponding to that ISP. The 
potential mechanisms to communicate information about changes in the 
network to the host are Neighbor Discovery Router Advertisements, 
DHCPv6, and ICMP. </t> 

<t>The routers in the enterprise network are responsible for ensuring 
that packets are delivered to the "correct" ISP uplink based on source address.
This requires that at least some routers in the site network are able to take
into account the source address of a packet when deciding how to route it. That is, 
some routers must be capable of some form of Source Address Dependent Routing (SADR).
At a minimum, the routers connected to the ISP uplinks (the site exit routers or SERs)
must be capable of Source Address Dependent Routing.  Expanding the connected domain
of routers capable of SADR from the site exit routers deeper into the site network 
will generally result in more efficient routing of traffic with external destinations.
</t>

<t>The document first looks in more detail at the enterprise networking
environments in which this solution is expected to operate. It then discusses
existing and proposed mechansisms for hosts to select the source address applied 
to packets. Finally, it looks at the requirements for routing that are needed 
to support these enterprise network scenarios and the mechanisms by which hosts
are expected to select source addresses dynamically based on network state.
</t>

</section>


<section anchor="sec_enterprise_req" title="Enterprise Multihoming Requirements">


<section anchor="sec_simple_scenario" title="Simple Multihoming Scenario">
<t>We start by looking at a simple scenario where a site has connections to two ISPs,
as shown in <xref target="fig_simple_scenario"/>.
The site is assigned the prefix 2001:0db8:0:a000::/52 by ISP-A 
and prefix 2001:0db8:0:b000::/52 by ISP-B. 
We consider three hosts in the site.  H31 and H32 are on a LAN  
that has been assigned subnets 2001:db8:0:a010::/64 and 
2001:db8:0:b010::/64.  H31 has been assigned the addresses 
2001:db8:0:a010::31 and 2001:db8:0:b010::31.  H32 has been assigned 
2001:db8:0:a010::32 and 2001:db8:0:b010::32.
H41 is on a different subnet that has been 
assigned 2001:db8:0:a020::/64 and 2001:db8:0:b020::/64.  
</t>



<figure anchor="fig_simple_scenario" title="Simple multihoming scenario " align="center">
<artwork align="center"><![CDATA[
                                        2001:db8:0:a010::101   H101
                                                                 |
                                                                 |
2001:db8:0:a010::31                                          --------
2001:db8:0:b010::31                            ,-----.      /        \
                   +--+   +--+       +----+  ,'       `.   :          :
               +---|R1|---|R4|---+---|SERa|-+   ISP-A   +--+--        :
          H31--+   +--+   +--+   |   +----+  `.       ,'   :          :
               |                 |             `-----'     : Internet :
               |                 |                         :          :
               |                 |                         :          :
               |                 |                         :          :
               |                 |             ,-----.     :          :
          H32--+   +--+          |   +----+  ,'       `.   :          :
               +---|R2|----------+---|SERb|-+   ISP-B   +--+--        :
                   +--+          |   +----+  `.       ,'   :          :
                                 |             `-----'     :          :
                                 |                         :          :
                   +--+  +--+  +--+                         \        /
          H41------|R3|--|R5|--|R6|                          --------  
                   +--+  +--+  +--+ 

2001:db8:0:a020::41 
2001:db8:0:b020::41

]]></artwork>
</figure>

<t>We refer to a router that connects the site to an ISP as a site edge router(SER).
Several other routers provide connectivity among the internal hosts 
(H31, H32, and H41), as well as connecting the internal 
hosts to the Internet through SERa and SERb.  In this example 
SERa and SERb share a direct connection to each other.  
In <xref target="sec_simple_not_dir_conn"/>,
we consider a scenario where this is not the case.
</t>

<t> For the moment, we assume that the hosts are able to make good choices about 
which source addresses through some mechansism that doesn't involve the routers in the site
network.  Here, we focus on primary task of the routed site network, which is to get packets
efficiently to their destinations, while sending a packet to the ISP that assigned the prefix
that matches the source address of the packet.  In 
<xref target="sec_host_mechanisms"/>, we examine what role the routed network
may play in helping hosts make good choices about source addresses for packets.
</t>

<t>  With this solution, routers will need form of Source Address Dependent Routing, 
which will be new funtionality.  It would be useful if an enterprise site does not 
need to upgrade all routers to support the new SADR functionality in order to support 
PA multi-homing.  We consider if this is possible and what are the tradeoffs of not 
having all routers in the site support SADR functionality.
</t>

<t>In the topology in <xref target="fig_simple_scenario"/>, it is possible to 
support PA multihoming with only SERa and SERb being capable of SADR.  The other routers 
can continue to forward based only on destination address, and exchange routes that 
only consider destination address.  In this scenario, SERa and SERb communicate source-scoped
routing information across their shared connection.  When SERa receives a packet 
with a source address matching prefix 2001:0db8:0:b000::/52 , 
it forwards the packet to SERb, which forwards it on
the uplink to ISP-B.  The analogous behavious holds for traffic that SERb recieves with a source
address matching prefix 2001:0db8:0:a000::/52.   
</t>

<t>In <xref target="fig_simple_scenario"/>, when only SERa and SERb are capable of 
source address dependent routing, PA multi-homing will work.  However, the paths over which 
the packets are sent will generally not be the shortest paths.  The forwarding paths will 
generally be more efficient as more routers are capable of SADR.  For example, if R4, R2, and R6
are upgraded to support SADR, then can exchange source-scoped routes with SERa and SERb. 
They will thne know to send traffic with a 
source address matching prefix 2001:0db8:0:b000::/52 directly to SERb, without sending
it to SERa first.
</t> 

</section>

<section anchor="sec_simple_not_dir_conn" title="Simple multihoming scenario where
SERs are not directly connected">

<t>In <xref target="fig_simple_not_dir_conn"/>, we modify the topology slightly 
by inserting R7, so that SERa and SERb are no longer directly connected.  With
this topology, it is not enough to just enable SADR routing on SERa and SERb to support
PA multi-homing.  There are two solutions to ways to enable PA multihoming in this 
topology.
</t> 

<figure anchor="fig_simple_not_dir_conn" title="Simple multihoming scenario where
SERs are not directly connected " align="center">
<artwork align="center"><![CDATA[
                                        2001:db8:0:1234::101    H101
                                                                 |
                                                                 |
2001:db8:0:a010::31                                          --------
2001:db8:0:b010::31                            ,-----.      /        \
                   +--+   +--+       +----+  ,'       `.   :          :
               +---|R1|---|R4|---+---|SERa|-+   ISP-A   +--+--        :
          H31--+   +--+   +--+   |   +----+  `.       ,'   :          :
               |                 |             `-----'     : Internet :
               |               +--+                        :          :
               |               |R7|                        :          :
               |               +--+                        :          :
               |                 |             ,-----.     :          :
          H32--+   +--+          |   +----+  ,'       `.   :          :
               +---|R2|----------+---|SERb|-+   ISP-B   +--+--        :
                   +--+          |   +----+  `.       ,'   :          :
                                 |             `-----'     :          :
                                 |                         :          :
                   +--+  +--+  +--+                         \        /
          H41------|R3|--|R5|--|R6|                          --------  
                   +--+  +--+  +--+                              |
                                                                 | 
2001:db8:0:a020::41                     2001:db8:0:5678::501    H501
2001:db8:0:b020::41

]]></artwork>
</figure>

<t> One option is to effectively modify the topology by creating a logical tunnel between 
SERa and SERb, using GRE for example.  Although SERa and SERb are not directly connected physically
in this topology, they can be directly connected logically by a tunnel.
</t> 

<t> The other option is to enable SADR functionality on R7.  In this way, R7 will
exchange source-scoped routes with SERa and SERb, making the three routers act as a
single SADR domain.  This illustrates the basic principle that the minimum requirement 
for the routed site network to 
support PA multi-homing is having all of the site exit routers be part of a 
connected SADR domain.  Extending the connected SADR domain beyond that point 
can produce more efficient forwarding paths.
</t> 

<t> Before considering a more complex scenario, let's look in more detail at the
reasonably simple multihoming scenario in <xref target="fig_simple_not_dir_conn"/> to understand 
what can reasonably be expected from this solution.  As a general guiding principle,
an enterprise network operator will expect a multihomed network to behave as 
close as to a single-homed network as possible.  
</t> 

<t> To simplifiy the discussion below, we assume that all of the routers in 
the site support SADR.
</t> 

<t> For traffic between internal hosts and traffic from outside the site to 
internal hosts, an enterprise network operator would expect there to be 
no visible change in the path taken by this traffic, 
since this traffic does not need to be routed in a way that depends on source address.  
This can be accomplised by having all of the routers in the network 
continue to originate normal unscoped destination routes
for their connected networks.  If we can arrange so that these unscoped 
destination routes get used for forwarding this traffic, then we will have accomplished
the goal of keeping forwarding of traffic destined for internal hosts unaffected by 
the multihoming solution.  
</t>

<t>

For traffic destined for external hosts, the network operator 
should expect different 
SERa will originate a source-scoped route of the form 
(S=2001:0db8:0:a000::/52, D=::/0), while SERb will originate a 
source-scoped route of the form (S=2001:0db8:0:b000::/52, D=::/0).  
</t> 



</section>

<section anchor="sec_provider_assigned" title="Provider-assigned addresses">
<t> We want to allow multi-homing to more than two service providers. So mechanism should 
be general enough to allow multi-homing to an aribitrary number of service providers. However,
from a practical point of view, we would expect most cases to be 
dual-homing to just two providers. 
</t>
<t> We also assume that the provider-assigned addresses from a single provider can be
represented as a small number of prefixes.  The majority will be a single prefix per provider, but 
we allow for the possibility that a provider assigns mulitple prefixes to a site.  
</t>

<t> With these two assumptions, we expect most cases to have two provider-assigned
prefixes, one for each provider. The worst case might involve ten provider-assigned
prefixes used to connect to four different service providers.  
</t>

</section>

<section anchor="sec_no_nat" title="No NAT or NPTv6">
<t> 

</t>
</section>


<section anchor="sec_no_topology_limitations" title="No limitations site network topology ">
<t> 

</t>
</section>

<section anchor="sec_incremental_deployment" title="Benefit from incremental deployment">
<t> 

</t>
</section>

<section anchor="sec_not_worse" title="Multihomed network should not function worse than non-multihomed network, even in the presence of failures ">
<t> 
  
</t>
</section>

<section anchor="sec_external_session_initiation" title="External and internal session initiation">
<t> A external host should be able to initiate a session with a host internal to the site.  

</t>
</section>

<section anchor="sec_uplinks_to_isps" title="Uplinks to ISPs">
<t> The most common scenario will be where the interfaces between site exit routers and ISPs 
will correspond to different physical interfaces.
</t>  

<t> There are however scenarios where 
a single physical interface from an ISP is logically partitioned using, for example, VLAN tagging.
In this case, the different logical sub-interfaces may have different source address ingress filtering rules 
applied, so the different sub-interfaces would need to be treated as if they are multi-homed to different ISPs.  
The solution should accomodate the common scenario, as well more complex scenarios involving physical 
interfaces divided into sub-interfaces.
</t>   

<t> There are also scenarios where different site exit interfaces connect to the same ISP, which 
will apply the same source address ingress filtering rules to the traffic on those interfaces.
The solution should accomodate this scenario as well. 
</t> 

</section>

<section anchor="sec_extent_of_site" title="Extent of enterprise site">
<t> The most common scenario will be a single physical site connecting to two upstream providers.
However, an enterprise site may interconnect physical sites using leased lines or tunnels.  From 
a routing point of view, several physical sites may be combined into a single enterprise network site.
The solution should accomodate the more common scenario, as well as more complex scenarios, as long 
as they are consistent with other restrictions.
</t>
</section>

<section anchor="sec_complexity_of_routing" title="Complexity of routing to upstream ISPs">
<t>  The most common multihoming scenario will be for the enterprise network site to point
a default route towards each of its upstream ISPs.  

An enterprise network site which has connections to multiple ISPs may run eBGP with each of those ISPs.
If the ISPs distribute all or some of the Internet routing table over the eBGP sessions, then the enterprise
site can 


</t>
</section>

<section anchor="sec_existing_IGP" title="Enterprise network uses existing IGP within the site ">
<t>  
OSPFv3, ISIS, or RIPng with some potential enhancements on routers that do source address dependent routing.
</t>
</section>

<section anchor="sec_load_sharing" title="Load sharing  ">
<t> When uplinks to multiple ISPs are working, it should be possible for traffic
from the site use multiple uplinks.  This could take the form of different 
flows from the same host using different uplinks. Or it could take the form 
of all traffic from some hosts using one uplink, and all traffic from other 
hosts using a different uplink.
</t>
</section>

<section anchor="sec_response_to_failures" title="Response to failures  ">
<t> When an uplink fails, all hosts should be able to use the remaining uplinks.
</t>


</section>

<section anchor="sec_classes_of_destinations" title="classes of destinations.">
<t> Class A, B, and C. 

</t>
</section>


</section>

<section anchor="sec_host_mechanisms" title="Mechanisms for hosts to choose source addresses">
<t> Any host that needs to be able to communicate using the uplinks to a given ISP is expected to be
configured with an address from the prefix assigned by that ISP.  The host will 
control which ISP is used for its traffic by selecting one of the addresses configured on 
the host as the source address for outgoing traffic.  It is the responsibility of the enterprise 
network to ensure that a packet with the source address from one ISP is not sent on the uplink to 
a different ISP.
</t>

<t> If all of the ISP uplinks are working, the choice of source address by the host 
may be driven by the desire to load share across ISP uplinks, or it may be driven by the desire to 
take advantage of certain properties of a particular uplink or ISP.  If any of the ISP uplinks 
is not working, then the choice of source address by the host can determine if packets get dropped.   
</t>

<t> How to make the host make good decisions about source address selection is not a solved problem.
We do not attempt to solve this problem in this document.  Instead we discuss the characteristics
of the mechansisms that have been proposed to help hosts select good source addresses in order to 
understand what requirements they may place on enterprise routing to support multihoming.
</t>

<t> The shim6 protocol provides a mechasism that allows a pair of
hosts to associate multiple IP addresses with each host.  Due to the lack of 
adoption of shim6, this document assumes that hosts are not able to take advantage of the 
capabilities provided by shim6.
</t>

<section anchor="sec_sessions_from_external_hosts" title="Sessions initiated from external hosts">
<t> An external host initiating communication with a host internal to a PA multihomed site
will need to know multiple addresses for that host in order to communicate with it using
different ISPs to the multihomed site. These addresses are typically learned through DNS.  
(For simplicity, we assume that the external host is single-homed.)
The external host chooses the ISP that will be used at the remote multihomed site by setting
the destination address on the packets it transmits. 
</t>

<t> When all of the ISP uplinks from the multihomed site are working, the destination address 
used by the external host could be used to control load sharing on the uplinks.  
In the event a failure of one of the ISP uplinks, the destination address used by the 

</t>

<t> 
For a sessions originated from an external host to an internal host, the choice of source address
used by the internal host is simple.  The internal host has no choice but to use the destination 
address in the received packet as the source address of the transmitted packet.   
</t>
</section>

<section anchor="sec_sessions_from_internal_hosts" title="Sessions initiated from internal hosts">
<t> For a session originated by a host internal to the multi-homed site, the decision of what source 
address to select is more complicated.  There are three main ways for hosts to get information about the 
network:  Neighbor Discovery Router Advertisements (RAs), DHCPv6, and ICMPv6.  
</t>

<t> 
<xref target="RFC6724"/> defines the current default address selection policy for IPv6. It uses properties of
the addresses themselves such as scope (link-local, global, etc.) and whether or not the .  As section points out that
this default policy fa


<xref target="RFC6724"/> relies on address 

</t>


</section>

<section anchor="sec_ND_RA" title="Hosts learn information about the network via Neighbor Discovery Router Advertisements">
<t> 

</t>
</section>

<section anchor="sec_DHCPv6" title="Hosts may learn information about the network via DHCPv6">
<t> 

</t>
</section>


</section>


<section anchor="sec_routing_protocol_expectations" title="What we expect the routing protocol to provide">
<t> 

</t>

<section anchor="sec_primary_goal" title="Primary goal: Make sure that packets are always 
delivered to the correct site exit router">
<t> 
Packet should be routed with the following criteria:

1) Forwarding is loop-free
2) Packets are delivered to site exit router whose uplink will accept packets with that source address.


</t>
</section>

<section anchor="sec_secondary_goal" title="Secondary goal: Provide information to routers adjacent to hosts that
can be converted to ND Router Advertisements  which in turn assist the host with source address selection ">
<t> 

</t>
</section>

</section>


<section anchor="sec_asfdadf" title="Two pass route lookup model ">
<t> 
Each router maintains a destination-based route table for 
</t>
</section>

    <section anchor="L3" title="Internet layer (IPv6)">
      <t/>

      <section anchor="L3-sadr" title="SADR forwarding (router)">
        <t>A SADR Router is a router that makes routing and forwarding
        decisions based on both the source and destination addresses in an IP
        packet.</t>

        <t>There are at least three ways one could build the forwarding plane:
        use the source address to select a destination Forwarding Information
        Base (FIB), use the destination address to select a source address FIB
        or filter, or use the two as a combined key in the same mechanism to
        find a source/destination prefix pair in the FIB.</t>

        <t>The first two are well understood; follow a longest-match-first
        rule on the source or destination address in a radix tree or other
        type of database, and do so again with the other address.</t>

        <t>Algorithms exist for the third, such as <xref target="PATRICIA"/>;
        a potentially discontiguous bit pattern (the source and destination
        address) is analyzed to determine what bits are most important at any
        given stage in the lookup, and the lookup trie is organized
        accordingly. TCAMs, of course, look at the entire lookup key
        simultaneously, and are therefore another solution to the third case.
        The counterpart to "longest match first" in such an algorithm is "most
        specific match first".</t>

        <t>An important use case (<xref
        target="I-D.baker-rtgwg-src-dst-routing-use-cases"/>) for
        source/destination routing is in egress routing. Egress routing is
        essentially an enterprise or campus technology that presumes several
        default routes in the network associated with the various prefixes in
        use, and follows the default route for the relevant source prefix to
        an egress to an upstream network. In that formulation, it is a
        degenerate algorithm, perhaps best described as "source-specific"
        routing, as the actual destination (as long is it is not local, which
        would match a more specific route) is irrelevant - much as the source
        address is irrelevant in traditional destination routing.</t>

        <t>Other use cases, of which there are several, provide for the
        possibility of following one of several paths to the same destination
        based on the source prefix selected. That can be implemented as a set
        of default routes with additional more-specific routes.</t>
      </section>

      <section anchor="L3-addressing"
               title="Intelligent source address selection for a given destination">
        <t>Source address selection in IPv6 has been a challenge. The biggest
        single part of the challenge is that the host has no real
        understanding of the network it finds itself in; at best, it might
        know important parts of recent path state, or what has historically
        worked and some measurements of how well. Unless the host has
        configuration, history, or clairvoyance, it has no provably correct
        mechanism with which to make a selection.</t>

        <t>Existing RFCs on the topic, notably <xref target="RFC6724"/>, seek
        to avoid address formats that have undesirable characteristics, such
        as indicating the use of network address translation when an
        untranslated path is available, using technologies that have not
        worked well in the Internet, or using technologies that are
        politically incorrect. Having eschewed the obviously bad choices, they
        then recommend using the source address most similar to the
        destination, on the premise that this should minimize path length. The
        advice is probably generally good, but may also be suboptimal in
        individual cases.</t>
      </section>

      <section anchor="L3-host-ICMP"
               title="Reacting to timeouts and ICMP messages">
        <t>When a packet does something other than follow the most obvious
        path to its destination and arrive, the Internet Architecture
        generally expects the router or middleware discarding it to inform the
        sender why not. It does so using the <xref target="RFC4443">Internet
        Control Message Protocol</xref>.</t>

        <t>There are a number of cases in which that general dictum is not
        followed; link layer corruption may make the packet unintelligible, so
        that no system actually receives it to choose to drop it, the system
        dropping the packet may be configured to not send, or to rate limit
        the rate at which it sends, ICMP messages, and a filter en route may
        prevent the ICMP message from arriving. In such cases, the sender is
        left to intuit the failure from a timeout and take such corrective
        action as may be required.</t>

        <t>In a network with one prefix, the recovery action is simple: either
        retransmit, or inform the application that the session failed.</t>

        <t>In a network with more than one prefix (which might mean "has both
        an IPv4 and an IPv6 prefix", "has IPv4 or IPv6 prefixes on different
        interfaces", or "has more than one prefix, IPv4 or IPv6, on the same
        interface"), one alternative to simple retransmission using the same
        source address is to retransmit using a different source address.
        <xref target="RFC6555">Happy Eyeballs</xref> provides a relatively
        sophisticated way to accomplish that; in the simplest case, the socket
        API can simply select a different one.</t>
      </section>

      <section anchor="L3-host-Next-Hop"
               title="Intelligent first-hop selection (host)">
        <t><xref target="I-D.ietf-6man-multi-homed-host"/> addresses the
        question of first hop selection by a host. This is a routing question
        being answered by a system that in the general case has little
        knowledge of network routing. However, it does know what addresses it
        is using, on what interfaces, and how it obtained them. In a network
        using DHCP/DHCPv6, it knows that it can use as its first hop router a
        router on the interface the source address is associated with, which
        it learns by observing Router Advertisements, and it may have been
        given an ICMP Redirect to a different router. In a network using <xref
        target="RFC4862">IPv6 Stateless Address Autoconfiguration</xref> (in
        any of its variants), it knows what router advertised the prefix to
        it, and can use that as a first hop router.</t>
      </section>

      <section anchor="L3-ephemeral-addresses"
               title="Deal with addresses being ephemeral, interface state and interfaces appearing / disappearing">
        <t/>
      </section>
    </section>

    <section anchor="Routing" title="Routing layer">
      <t/>

      <section anchor="Routing-Protocol"
               title="Routing protocol for source/destination routing">
        <t>A Source/Destination routing protocol is a protocol that exchanges
        the information necessary for the calculation of a SADR FIB, and then
        calculates it. No currently-deployed protocol implements SADR routing
        at this point, although there are experiments in progress. <xref
        target="I-D.baker-ipv6-isis-dst-src-routing">IPv6 Source/Destination
        Routing using IS-IS</xref>, <xref
        target="I-D.xu-src-dst-bgp">Source/Destination Routing Using
        BGP-4</xref>, <xref
        target="I-D.boutier-babel-source-specific">Source-Specific Routing in
        Babel</xref>, and <xref target="RFC7788">Home Networking Control
        Protocol</xref> are examples of source/destination routing
        protocols.</t>
      </section>
    </section>

    <section anchor="L4" title="Transport layer">
      <t/>

      <section anchor="L4-path-fail" title="Handle failure in one path">
        <t/>
      </section>

      <section anchor="L4-load-share" title="Share load across multiple paths">
        <t/>
      </section>

      <section anchor="L4-path-restore"
               title="Bring up path again after failure">
        <t/>
      </section>
    </section>

    <section anchor="L5" title="Session layer">
      <t/>

      <section anchor="L5-session"
               title="Recover session e.g. moving from home to office">
        <t/>
      </section>
    </section>
	
<section anchor="sec_nptv6" title="IPv6-to-IPv6 Network Prefix Translation">

<t>IPv6-to-IPv6 Network Prefix Translation is not the focus of this 
document. This document describes a solution where a host in a 
multihomed site determines which ISP a packet will be sent to based on 
the source address it applies to the packet. This solution has many 
moving parts. It requires 
some routers in the enterprise site to support an as-yet-unspecified 
form of Source Address Dependent Routing (SADR). It requires a host to 
be able to learn when the uplink to an ISP fails so that it can stop 
using the source address corresponding to that ISP. Ongoing work to 
create mechansisms to accomplish this are discussed in this document, 
but they are still a work in progress. 
</t>

<t> The requirements in this document aim at creating a PA multihoming 
solution that is as easy as possible for an enterprise to deploy. However, 
the success of this solution will depend greatly on whether or not the 
as-yet-unspecified mechanisms for hosts to select source addresses based 
on the state of ISP uplinks gets implemented across a wide range of 
operating systems as the default mode of operation.
Until that occurs, NPTv6 should still be 
considered a viable option to enable PA multihoming for enterprises. 
</t>

</section>
	

    <section anchor="IANA" title="IANA Considerations">
      <t>This memo asks the IANA for no new parameters.</t>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t/>

      <section anchor="Privacy" title="Privacy Considerations">
        <t/>
      </section>
	  
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>The original outline was suggested by Ole Troan.  Many of the ideas 
	  in this draft were described in <xref target="I-D.huitema-shim6-ingress-filtering"/> . </t>
    </section>
  </middle>

  <back>
    <!-- references split to informative and normative -->

<references title="Normative References">
<?rfc include="reference.RFC.2827" ?>

<?rfc include="reference.RFC.4193" ?>

<?rfc include="reference.RFC.6296" ?>

<?rfc include="reference.RFC.1918" ?>

<?rfc include="reference.RFC.1122" ?>

<?rfc include="reference.RFC.1123" ?>

<?rfc include="reference.RFC.2119"?>

<?rfc include="reference.RFC.2460"?>

<?rfc include="reference.RFC.3582" ?>

<?rfc include="reference.RFC.4116" ?>

      <?rfc include="reference.RFC.4218" ?>

      <?rfc include="reference.RFC.4219" ?>

      <?rfc include="reference.RFC.7157" ?>
    </references>

    <references title="Informative References">
	
      <?rfc include="reference.I-D.huitema-shim6-ingress-filtering" ?>
	  
      <?rfc include="reference.I-D.baker-ipv6-isis-dst-src-routing" ?>

      <?rfc include="reference.I-D.baker-rtgwg-src-dst-routing-use-cases" ?>

      <?rfc include="reference.I-D.boutier-babel-source-specific" ?>

      <?rfc include="reference.I-D.ietf-6man-multi-homed-host" ?>

      <?rfc include="reference.I-D.ietf-mif-mpvd-arch" ?>

      <?rfc include="reference.I-D.ietf-mptcp-experience" ?>

      <?rfc include="reference.I-D.ietf-rtgwg-dst-src-routing" ?>

      <?rfc include="reference.I-D.xu-src-dst-bgp" ?>

      <?rfc include="reference.RFC.4443" ?>

      <?rfc include="reference.RFC.4862" ?>

      <?rfc include="reference.RFC.6555" ?>

      <?rfc include="reference.RFC.6724" ?>

      <?rfc include="reference.RFC.7788" ?>

      <reference anchor="PATRICIA">
        <front>
          <title>Practical Algorithm to Retrieve Information Coded in
          Alphanumeric</title>

          <author fullname="D.R. Morrison" initials="D.R." surname="Morrison">
            <organization>Association for Computing Machinery</organization>
          </author>

          <date month="October" year="1968"/>
        </front>

        <seriesInfo name="Journal of the ACM" value="15(4) pp514-534"/>

        <format target="http://www.csse.monash.edu.au/~lloyd/tildeAlgDS/Tree/PATRICIA/"
                type="HTML"/>
      </reference>
    </references>

    <section anchor="log" title="Change Log">
      <t><list style="hanging">
          <t hangText="Initial Version:">June 2016</t>
        </list></t>
    </section>
  </back>
</rfc>
